<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Produto - DevShop</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/produto.css">
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="logo">
        <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="40" height="40" rx="8" fill="url(#gradient)"/>
          <path d="M12 15L20 10L28 15V25L20 30L12 25V15Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 15L20 20L28 15" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M20 20V30" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <defs>
            <linearGradient id="gradient" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
              <stop stop-color="#6366f1"/>
              <stop offset="1" stop-color="#8b5cf6"/>
            </linearGradient>
          </defs>
        </svg>
        <h1>DevShop</h1>
      </div>
      <nav>
        <a href="index.html">Home</a>
        <a href="carrinho.html">Carrinho</a>
        <a href="pedidos.html">Pedidos</a>
      </nav>
    </div>
  </header>
  <main class="container">
    <div id="produto-detalhe"></div>
  </main>
  <script src="js/utils.js"></script>
  <script src="js/api.js"></script>
  <script>
    // Carregar produto por ?id=xx
    async function load() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      const container = document.getElementById('produto-detalhe');
      
      if (!id) {
        container.innerHTML = '<p>Produto não especificado.</p>';
        return;
      }
      
      try {
        const p = await buscarProduto(id);
        container.innerHTML = `
          <div class="produto-detalhes">
            <div class="produto-imagem">
              <img src="${p.imagem || 'https://via.placeholder.com/600x400'}" alt="${p.nome}">
            </div>
            <div class="produto-info">
              <h2>${p.nome}</h2>
              <p class="preco">R$ ${parseFloat(p.preco).toFixed(2)}</p>
              <p class="descricao">${p.descricao || 'Sem descrição disponível.'}</p>
              <p class="estoque">Em estoque: ${p.estoque} unidades</p>
              <div class="compra-box">
                <label for="qtd">Quantidade:</label>
                <input id="qtd" type="number" value="1" min="1" max="${p.estoque}">
                <button id="add" class="btn btn-primario">Adicionar ao Carrinho</button>
              </div>
            </div>
          </div>
        `;
        
        document.getElementById('add').addEventListener('click', () => {
          const qtd = parseInt(document.getElementById('qtd').value, 10) || 1;
          const produto = { id: p.id, nome: p.nome, preco: p.preco, quantidade: qtd };
          adicionarAoCarrinho(produto);
          alert('Produto adicionado ao carrinho!');
          window.location.href = 'carrinho.html';
        });
      } catch (err) {
        console.error(err);
        container.innerHTML = '<p>Erro ao carregar produto.</p>';
      }
    }
    load();
  </script>
  <script src="js/utils.js"></script>
</body>
</html>
